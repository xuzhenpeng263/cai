.use_base_container: &use_base_container
  stage: test
  image: "${CI_REGISTRY_IMAGE}:latest"
  services:
    - name: docker:dind
      alias: docker

.run_test: &run_test
  <<: *use_base_container
  script:
    - pip3 install -e .
    - pip install inline-snapshot pytest-asyncio graphviz pytest-mock
    - echo 'OPENAI_API_KEY="sk-fake"' > .env
    - pytest -s $TEST_PATH
  tags:
    - p40
    - x86
  rules:
    - if: $CI_COMMIT_BRANCH
      when: on_success

üõ†Ô∏è tools test_function_tool_decorator:
  <<: *run_test
  variables:
    TEST_PATH: tests/tools/test_function_tool_decorator.py

üõ†Ô∏è tools test_function_tool:
  <<: *run_test
  variables:
    TEST_PATH: tests/tools/test_function_tool.py

üõ†Ô∏è tools test_handoff_tool:
  <<: *run_test
  variables:
    TEST_PATH: tests/tools/test_handoff_tool.py  

üõ†Ô∏è tools test_output_tool:
  <<: *run_test
  variables:
    TEST_PATH: tests/tools/test_output_tool.py

üõ†Ô∏è tools test_tool_choice_reset:
  <<: *run_test
  variables:
    TEST_PATH: tests/tools/test_tool_choice_reset.py


üõ†Ô∏è tools test_tool_converter:
  <<: *run_test
  variables:
    TEST_PATH: tests/tools/test_tool_converter.py

üõ†Ô∏è tools test_tool_generic_linux_command:
  <<: *run_test
  variables:
    TEST_PATH: tests/tools/test_tool_generic_linux_command.py

üõ†Ô∏è tools test_tool_use_behavior:
  <<: *run_test
  variables:
    TEST_PATH: tests/tools/test_tool_use_behavior.py


ü§ñ agents test_agent_config:
  <<: *run_test
  variables:
    TEST_PATH: tests/agents/test_agent_config.py

ü§ñ agents test_agent_hooks:
  <<: *run_test
  variables:
    TEST_PATH: tests/agents/test_agent_hooks.py

# ü§ñ agents test_agent_one_tool:
#   <<: *run_test
#   variables:
#     TEST_PATH: tests/agents/test_agent_one_tool.py

ü§ñ agents test_agent_prompt_system_master_template:
  <<: *run_test
  variables:
    TEST_PATH: tests/agents/test_agent_prompt_system_master_template.py

ü§ñ agents test_agent_runner:
  <<: *run_test
  variables:
    TEST_PATH: tests/agents/test_agent_runner.py

ü§ñ agents test_agent_runner_streamed:
  <<: *run_test
  variables:
    TEST_PATH: tests/agents/test_agent_runner_streamed.py

ü§ñ agents test_global_hooks:
  <<: *run_test
  variables:
    TEST_PATH: tests/agents/test_global_hooks.py

ü§ñ agents test_guardrails:
  <<: *run_test
  variables:
    TEST_PATH: tests/agents/test_guardrails.py

ü§ñ agents test_items_helpers:
  <<: *run_test
  variables:
    TEST_PATH: tests/agents/test_items_helpers.py

ü§ñ agents test_max_turns:
  <<: *run_test
  variables:
    TEST_PATH: tests/agents/test_max_turns.py


ü§ñ agents test_agent_inference:
  <<: *run_test
  variables:
    TEST_PATH: tests/agents/test_agent_inference.py

# ‚öôÔ∏è core test_openai_chatcompletions:
#   <<: *run_test
#   variables:
#     TEST_PATH: tests/core/test_openai_chatcompletions.py

‚öôÔ∏è core test_openai_chatcompletions_converter:
  <<: *run_test
  variables:
    TEST_PATH: tests/core/test_openai_chatcompletions_converter.py

# ‚öôÔ∏è core test_openai_chatcompletions_stream:
#   <<: *run_test
#   variables:
#     TEST_PATH: tests/core/test_openai_chatcompletions_stream.py

‚öôÔ∏è core test_openai_responses_converter:
  <<: *run_test
  variables:
    TEST_PATH: tests/core/test_openai_responses_converter.py

# ‚öôÔ∏è core test_responses:
#   <<: *run_test
#   variables:
#     TEST_PATH: tests/core/test_responses.py

‚öôÔ∏è core test_run_config:
  <<: *run_test
  variables:
    TEST_PATH: tests/core/test_run_config.py

‚öôÔ∏è core test_run_step_execution:
  <<: *run_test
  variables:
    TEST_PATH: tests/core/test_run_step_execution.py

‚öôÔ∏è core test_run_step_processing:
  <<: *run_test
  variables:
    TEST_PATH: tests/core/test_run_step_processing.py

‚úèÔ∏è tracing test_agent_tracing:
  <<: *run_test
  variables:
    TEST_PATH: tests/tracing/test_agent_tracing.py    

‚úèÔ∏è tracing test_processor_api_key:
  <<: *run_test
  variables:
    TEST_PATH: tests/tracing/test_processor_api_key.py   

‚úèÔ∏è tracing test_responses_tracing:
  <<: *run_test
  variables:
    TEST_PATH: tests/tracing/test_responses_tracing.py    

‚úèÔ∏è tracing test_tracing_errors_streamed:
  <<: *run_test
  variables:
    TEST_PATH: tests/tracing/test_tracing_errors_streamed.py    

‚úèÔ∏è tracing test_tracing_errors:
  <<: *run_test
  variables:
    TEST_PATH: tests/tracing/test_tracing_errors.py   

‚úèÔ∏è tracing test_tracing:
  <<: *run_test
  variables:
    TEST_PATH: tests/tracing/test_tracing.py    

üé§ voice test_input.py:
  <<: *run_test
  variables:
    TEST_PATH: tests/voice/test_input.py

üé§ voice test_openai_stt.py:
  <<: *run_test
  variables:
    TEST_PATH: tests/voice/test_openai_stt.py

üé§ voice test_openai_tts.py:
  <<: *run_test
  variables:
    TEST_PATH: tests/voice/test_openai_tts.py   

üé§ voice test_pipeline.py:
  <<: *run_test
  variables:
    TEST_PATH: tests/voice/test_pipeline.py

üé§ voice test_workflow.py:
  <<: *run_test
  variables:
    TEST_PATH: tests/voice/test_workflow.py   

üìÄ mcp test_caching.py:
  <<: *run_test
  variables:
    TEST_PATH: tests/mcp/test_caching.py 

üìÄ mcp test_connect_disconnect.py:
  <<: *run_test
  variables:
    TEST_PATH: tests/mcp/test_connect_disconnect.py 

üìÄ mcp test_mcp_tracing.py:
  <<: *run_test
  variables:
    TEST_PATH: tests/mcp/test_mcp_tracing.py 

üìÄ mcp test_mcp_util.py:
  <<: *run_test
  variables:
    TEST_PATH: tests/mcp/test_mcp_util.py     
üìÄ mcp test_mcp_tracing.py:
  <<: *run_test
  variables:
    TEST_PATH: tests/mcp/test_mcp_tracing.py 

üìÄ mcp test_server_errors.py:
  <<: *run_test
  variables:
    TEST_PATH: tests/mcp/test_server_errors.py     

‚ñ™Ô∏è others test_computer_action.py:
  <<: *run_test
  variables:
    TEST_PATH: tests/others/test_computer_action.py   

‚ñ™Ô∏è others test_pretty_print.py:
  <<: *run_test
  variables:
    TEST_PATH: tests/others/test_pretty_print.py

‚ñ™Ô∏è others test_result_cast.py:
  <<: *run_test
  variables:
    TEST_PATH: tests/others/test_result_cast.py

# ‚ñ™Ô∏è others test_config.py:
#   <<: *run_test
#   variables:
#     TEST_PATH: tests/others/test_config.py

‚ñ™Ô∏è others test_strict_schema.py:
  <<: *run_test
  variables:
    TEST_PATH: tests/others/test_strict_schema.py

‚ñ™Ô∏è others test_doc_parsing.py:
  <<: *run_test
  variables:
    TEST_PATH: tests/others/test_doc_parsing.py

‚ñ™Ô∏è others test_trace_processor.py:
  <<: *run_test
  variables:
    TEST_PATH: tests/others/test_trace_processor.py

‚ñ™Ô∏è others test_extension_filters.py:
  <<: *run_test
  variables:
    TEST_PATH: tests/others/test_extension_filters.py

‚ñ™Ô∏è others test_visualization.py:
  <<: *run_test
  variables:
    TEST_PATH: tests/others/test_visualization.py

‚ñ™Ô∏è others test_function_schema.py:
  <<: *run_test
  variables:
    TEST_PATH: tests/others/test_function_schema.py    
